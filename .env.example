# Convex Deployment URL
# Get this from your Convex dashboard or by running: npx convex dev
CONVEX_DEPLOYMENT_URL=https://your-convex-deployment.convex.cloud

# Organization Name
# This will be displayed in the frontend UI
ORGANIZATION_NAME=Your Organization Name

# ---------------------------------------------------------------------------
# Polling & Presence
# ---------------------------------------------------------------------------

# Main loop interval (seconds). With tiered scanning this gives enough
# headroom for ~12 sequential l2pings plus Convex I/O.
POLLING_INTERVAL_SECONDS=15

# How long a device is considered present after last positive signal (seconds)
PRESENT_TTL_SECONDS=60

# Grace period for new device registration (seconds). New devices that
# connect have this long to be registered with a name before auto-deletion.
GRACE_PERIOD_SECONDS=300

# Retry cadence (seconds) for publishing newly seen devices to Convex
REGISTRATION_RETRY_SECONDS=5

# How long to keep retrying to publish a device after it disconnects (seconds)
UNPUBLISHED_DEVICE_TTL_SECONDS=600

# ---------------------------------------------------------------------------
# Tiered l2ping Scheduler
# ---------------------------------------------------------------------------

# Max devices in the "active" tier (recently present). Checked every cycle.
ACTIVE_TIER_MAX=20

# Number of "warm" tier devices (absent < WARM_TIER_THRESHOLD) per cycle.
WARM_TIER_BATCH=5

# Number of "cold" tier devices (absent >= WARM_TIER_THRESHOLD) per cycle.
COLD_TIER_BATCH=3

# Seconds of absence before a device moves from warm to cold tier.
WARM_TIER_THRESHOLD_SECONDS=600

# ---------------------------------------------------------------------------
# l2ping & Bluetooth (sequential â€” no threading to avoid HCI contention)
# ---------------------------------------------------------------------------

# Per-device l2ping timeout (seconds)
L2PING_TIMEOUT_SECONDS=2

# Number of l2ping packets per probe
L2PING_COUNT=1

# How long to wait for bluetoothctl connect attempts (seconds)
CONNECT_TIMEOUT_SECONDS=10

# Connect-probe fallback: after l2ping fails, try a quick bluetoothctl
# connect.  Devices that ignore L2CAP echo (some Android phones) briefly
# show Connected: yes, confirming presence.
CONNECT_PROBE_FALLBACK=true
CONNECT_PROBE_TIMEOUT_SECONDS=3
CONNECT_PROBE_MAX_PER_BATCH=2

# After this many consecutive l2ping failures a device skips l2ping and
# goes straight to connect-probe.  A single l2ping success resets.
L2PING_RESIST_THRESHOLD=3

# Cache TTL for bluetoothctl info calls (seconds)
DEVICE_INFO_CACHE_SECONDS=5

# ---------------------------------------------------------------------------
# Adaptive Hysteresis & Flap Detection
# ---------------------------------------------------------------------------

# Enable adaptive presence smoothing
ENABLE_ADAPTIVE_HYSTERESIS=true

# Hold a device "present" for this many seconds after last signal before
# allowing an absence transition.
ABSENCE_HOLD_SECONDS=90

# Consecutive missed cycles required before marking absent
ABSENCE_CONSECUTIVE_MISS_THRESHOLD=2

# Window (seconds) over which status transitions are counted for flap detection
FLAP_MONITOR_WINDOW_SECONDS=3600

# Number of transitions in the window that triggers a flap alert
FLAP_ALERT_THRESHOLD=4

# Automatically freeze status updates for flapping devices
ENABLE_AUTO_FREEZE_ON_FLAP=true
AUTO_FREEZE_DURATION_SECONDS=300

# Enable per-device diagnostic logging (verbose)
ENABLE_DEVICE_DIAGNOSTICS=false

# Device override file (quarantine / force-status)
DEVICE_OVERRIDE_FILE=config/device_overrides.json
DEVICE_OVERRIDE_REFRESH_SECONDS=30

# ---------------------------------------------------------------------------
# Fast-path Bluetooth Queue (optional)
# ---------------------------------------------------------------------------

FAST_PATH_QUEUE_ENABLED=true
FAST_PATH_QUEUE_HOST=127.0.0.1
FAST_PATH_QUEUE_PORT=51975
FAST_PATH_QUEUE_AUTH_KEY=presence-fast-path
FAST_PATH_QUEUE_RETRY_SECONDS=5
FAST_PATH_EVENT_SUPPRESSION_SECONDS=3

# ---------------------------------------------------------------------------
# Bluetooth Agent
# ---------------------------------------------------------------------------

# Adapter watchdog interval (seconds, 0 = disabled)
ADAPTER_WATCHDOG_INTERVAL_SECONDS=60
ADAPTER_RECOVERY_BACKOFF_SECONDS=5
ADVERTISE_NUDGE_COMMAND=bluetoothctl advertise on
ADVERTISE_SCAN_DURATION_SECONDS=3

# Pairing timeout (seconds)
PAIRING_TIMEOUT_SECONDS=30
